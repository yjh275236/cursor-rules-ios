---
alwaysApply: false
---
# 项目约定

## 编码流程

> **在添加、修改、重构代码前，必须先完成以下检查：**

### 前置检查清单
1. **任务判断**：本次任务是否需要读取/修改仓库代码？若否，保持常规答复，不启动 Serena
2. **代码复用**：搜索是否已有类似实现？如有，优先复用而非重写
3. **职责定位**：这段代码应该放在哪个类？职责是否匹配？（参考下方"代码位置判断标准"）
4. **重复检查**：是否在复制粘贴已有代码？如是，应该重构而非复制
5. **设计分析**：
   - 这段代码的职责是什么？（SRP）
   - 是通过扩展还是修改实现？（OCP）
   - 需要依赖哪些抽象接口？（DIP）

## 设计原则

### 单一职责（SRP）
**原则**：一个类只有一个变化原因  
**执行**：
- Controller → 只协调视图，不处理网络/数据库/业务逻辑
- Request → 只封装 API 调用，不处理界面更新
- Cell → 只展示数据，通过 delegate 传递事件
- 路由层（如 AppDelegate）→ 只负责导航分发，不实现业务细节

### 开闭原则（OCP）
**原则**：对扩展开放，对修改关闭  
**执行**：
- 新功能优先通过 `extension` 添加
- 使用 Protocol 定义接口，避免修改现有实现类

### 依赖倒置（DIP）
**原则**：依赖抽象而非具体实现  
**执行**：
- 函数参数优先使用 Protocol 而非具体类型
- 通过依赖注入传递依赖，避免在类内部直接创建

### 接口隔离（ISP）
**执行**：使用多个小 Protocol，而非单一大接口

### 里氏替换（LSP）
**执行**：子类不应改变父类的行为契约

### 迪米特法则（LoD）
**执行**：对象只与直接依赖通信，避免链式调用

## 代码位置判断标准

**职责分离原则**：
- **网络请求、业务逻辑** → ViewController 或专门的 Manager/Service
- **UI 展示、交互** → ViewController 或自定义 View
- **路由跳转** → AppDelegate（应保持精简，仅负责导航分发）
- **通用工具、格式化** → Utils/Extensions

**警告信号**：
- 路由层包含复杂业务逻辑 → 必须重构到对应的业务层
- Controller 层包含其他 Controller 的业务逻辑 → 应提取到共享服务或工具类

## 强制约束

**禁止**：
- ❌ Controller 中直接调用 AFNetworking/URLSession
- ❌ Request 类导入 UIKit
- ❌ 使用全局变量传递状态
- ❌ 路由层实现复杂业务逻辑（应保持精简，仅负责导航）

**推荐**：
- ✅ 使用 Protocol + Extension 组织代码
- ✅ 值类型（Struct/Enum）优先于引用类型
- ✅ 工具类和扩展用于共享通用功能

