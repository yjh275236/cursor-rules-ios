# é—®é¢˜å¤„ç†ç»éªŒè®°å½•

> ğŸ“ **ç”¨é€”**ï¼šè®°å½•é¡¹ç›®ä¸­é‡åˆ°çš„é‡è¦æŠ€æœ¯é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œä¾›å›¢é˜Ÿå­¦ä¹ å‚è€ƒ

---

## ğŸ“‘ ç›®å½•

- [Haneke å›¾ç‰‡åŠ è½½å´©æºƒ - 2025-11-06](#-haneke-å›¾ç‰‡åŠ è½½å´©æºƒ---2025-11-06)

---

## ğŸ“Œ AI å¦‚ä½•æ·»åŠ æ–°è®°å½•

å½“æˆåŠŸè§£å†³ä¸€ä¸ªé‡è¦æŠ€æœ¯é—®é¢˜åï¼Œè¯·åœ¨æœ¬æ–‡ä»¶é¡¶éƒ¨ï¼ˆæ‰€æœ‰é—®é¢˜è®°å½•ä¹‹å‰ï¼‰æ·»åŠ æ–°æ¡ç›®ã€‚åˆ¤æ–­æ˜¯å¦å€¼å¾—è®°å½•çš„æ ‡å‡†ï¼š**è¿™ä¸ªé—®é¢˜æ˜¯å¦å…·æœ‰éšè”½æ€§ã€ä»£è¡¨æ€§ï¼Œæˆ–è€…è§£å†³æ–¹æ¡ˆæ˜¯å¦æœ‰æŠ€æœ¯ä»·å€¼ï¼Ÿ**å¸¸è§çš„é…ç½®é”™è¯¯ã€æ‹¼å†™é”™è¯¯ç­‰ä¸éœ€è¦è®°å½•ã€‚

æ·»åŠ æ—¶è¯·éµå¾ªä»¥ä¸‹æ ¼å¼å’Œè§„èŒƒï¼šä½¿ç”¨ç»Ÿä¸€çš„æ ‡é¢˜æ ¼å¼ `## ğŸ”§ [é—®é¢˜ç®€è¿°] - YYYY-MM-DD`ï¼Œç„¶åæŒ‰é¡ºåºåŒ…å«å››ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š**é—®é¢˜æ ¹æº**ï¼ˆæŠ€æœ¯åŸç†å±‚é¢çš„æ ¹æœ¬åŸå› ï¼‰ã€**é—®é¢˜æ¼”å˜è¿‡ç¨‹**ï¼ˆä»æœ€åˆå°è¯•åˆ°æœ€ç»ˆæ–¹æ¡ˆçš„è¿‡ç¨‹ï¼Œå¸®åŠ©ç†è§£ä¸ºä»€ä¹ˆç®€å•æ–¹æ¡ˆä¸è¡Œï¼‰ã€**æœ€ç»ˆè§£å†³æ–¹æ¡ˆ**ï¼ˆæ ¸å¿ƒä»£ç å’Œå…³é”®æ­¥éª¤ï¼‰ã€**ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ‰æ•ˆ**ï¼ˆæŠ€æœ¯åŸç†è§£é‡Šï¼‰ã€‚ä»£ç ç¤ºä¾‹åº”ç²¾ç®€åˆ°æ ¸å¿ƒé€»è¾‘ï¼Œé¿å…å®Œæ•´çš„å‡½æ•°ä½“ï¼Œä½¿ç”¨æ³¨é‡Šæ ‡æ³¨å…³é”®ç‚¹ã€‚è®°ä½ï¼šé‡ç‚¹æ˜¯è®²æ¸…æ¥š**ä¸ºä»€ä¹ˆ**ï¼Œè€Œä¸ä»…ä»…æ˜¯**æ€ä¹ˆåš**ã€‚

**é‡è¦**ï¼šæ·»åŠ æ–°è®°å½•åï¼Œè¯·åœ¨æ–‡ä»¶é¡¶éƒ¨çš„"ğŸ“‘ ç›®å½•"ä¸­æ·»åŠ å¯¹åº”çš„é“¾æ¥ï¼Œæ ¼å¼ä¸ºï¼š`- [é—®é¢˜ç®€è¿° - æ—¥æœŸ](#-é—®é¢˜ç®€è¿°---æ—¥æœŸ)`ï¼ˆæ³¨æ„æ ‡é¢˜ä¸­çš„ç©ºæ ¼åœ¨é“¾æ¥ä¸­ç”¨ `-` æ›¿æ¢ï¼‰ã€‚

---

## ğŸ”§ Haneke å›¾ç‰‡åŠ è½½å´©æºƒ - 2025-11-06

### é—®é¢˜æ ¹æº

Haneke åº“åœ¨åŠ è½½å›¾ç‰‡æ—¶ä¼šè‡ªåŠ¨æ ¹æ® UIImageView çš„å°ºå¯¸ä¼˜åŒ–ç¼“å­˜ã€‚å†…éƒ¨æœ‰ä¸¥æ ¼çš„æ–­è¨€æ£€æŸ¥ï¼š

```swift
// Haneke å†…éƒ¨å®ç°
assert(viewSize.width > 0 && viewSize.height > 0, 
       "UIImageView size is zero. Set its frame first.")
```

å½“ UIImageView å°ºå¯¸ä¸º 0 æ—¶ä¼šè§¦å‘å´©æºƒã€‚åœ¨ Cell çš„ `configure` æ–¹æ³•ä¸­ï¼ŒSnapKit çº¦æŸè™½ç„¶å·²è®¾ç½®ï¼Œä½†å°šæœªç”Ÿæ•ˆï¼Œæ­¤æ—¶ `iconImageView.bounds` ä»ç„¶æ˜¯ `(0, 0)`ã€‚

---

### ğŸ“‹ é—®é¢˜æ¼”å˜è¿‡ç¨‹

**ç¬¬ä¸€é˜¶æ®µ** - åŸå§‹ä»£ç ä½¿ç”¨ URLSession æ‰‹åŠ¨ä¸‹è½½ï¼Œ20+ è¡Œä»£ç ï¼Œæ— ç¼“å­˜ï¼Œæ¯æ¬¡é‡æ–°ä¸‹è½½ã€‚

**ç¬¬äºŒé˜¶æ®µ** - æ”¹ç”¨ Haneke ç›´æ¥è°ƒç”¨ï¼š
```swift
iconImageView.hnk_setImageFromURL(url)  // âŒ å´©æºƒ
```
é—®é¢˜ï¼š`configure` æ—¶çº¦æŸæœªç”Ÿæ•ˆï¼Œå°ºå¯¸ä¸º 0ã€‚

**ç¬¬ä¸‰é˜¶æ®µ** - å»¶è¿Ÿåˆ° `layoutSubviews`ï¼š
```swift
func configure() {
    pendingImageURL = url
    setNeedsLayout()
}
override func layoutSubviews() {
    iconImageView.hnk_setImageFromURL(url)  // âš ï¸ å›¾ç‰‡ä¸è‡ªåŠ¨åŠ è½½
}
```
é—®é¢˜ï¼š`layoutSubviews` æœªåŠæ—¶è§¦å‘ï¼Œæˆ–è§¦å‘æ—¶å°ºå¯¸ä»ä¸º 0ã€‚

---

### æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼šåŒé‡ä¿éšœ

**æ ¸å¿ƒæ€è·¯**ï¼šå¼‚æ­¥å»¶è¿ŸåŠ è½½ + `layoutSubviews` å…œåº•

```swift
func configure(...) {
    pendingImageURL = url
    
    // æ–¹æ¡ˆ1ï¼šå»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ª runloop
    DispatchQueue.main.async { [weak self] in
        guard let self = self, let url = self.pendingImageURL else { return }
        if self.iconImageView.bounds.width > 0 {
            self.iconImageView.hnk_setImageFromURL(url)
            self.pendingImageURL = nil
        } else {
            self.setNeedsLayout()  // è§¦å‘å…œåº•æ–¹æ¡ˆ
        }
    }
}

// æ–¹æ¡ˆ2ï¼šlayoutSubviews å…œåº•
override func layoutSubviews() {
    super.layoutSubviews()
    if let url = pendingImageURL, iconImageView.bounds.width > 0 {
        iconImageView.hnk_setImageFromURL(url)
        pendingImageURL = nil
    }
}

// é¢å¤–ï¼šæ¸…ç†å¤ç”¨
override func prepareForReuse() {
    super.prepareForReuse()
    pendingImageURL = nil
    iconImageView.image = nil
}
```

---

### ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ‰æ•ˆï¼Ÿ

**1. DispatchQueue.main.async çš„æ—¶åºä½œç”¨**

```
configure è°ƒç”¨ â†’ async é—­åŒ…å…¥é˜Ÿ â†’ configure è¿”å›
      â†“
æ‰§è¡Œä¸‹ä¸€ä¸ª runloop
      â†“
UIKit åº”ç”¨çº¦æŸ â†’ iconImageView.bounds = (50, 50) âœ…
      â†“
async é—­åŒ…æ‰§è¡Œ â†’ å°ºå¯¸æ£€æŸ¥é€šè¿‡ â†’ åŠ è½½å›¾ç‰‡
```

å»¶è¿Ÿä¸€ä¸ª runloop ç»™äº† UIKit æ—¶é—´å®Œæˆå¸ƒå±€è®¡ç®—ã€‚

**2. åŒé‡ä¿éšœçš„å¿…è¦æ€§**

- æ­£å¸¸æƒ…å†µï¼šasync æ‰§è¡Œæ—¶å°ºå¯¸å·²ç¡®å®š â†’ ç«‹å³åŠ è½½ âœ…
- æç«¯æƒ…å†µï¼šasync æ‰§è¡Œæ—¶å°ºå¯¸ä»ä¸º 0 â†’ è§¦å‘ `layoutSubviews` â†’ å†æ¬¡æ£€æŸ¥åŠ è½½ âœ…

**3. ä¸¥æ ¼çš„å°ºå¯¸æ£€æŸ¥**

å³ä½¿åœ¨ `layoutSubviews` ä¸­ä¹Ÿæ£€æŸ¥å°ºå¯¸ï¼Œå› ä¸ºï¼š
- `layoutSubviews` å¯èƒ½è¢«å¤šæ¬¡è°ƒç”¨
- æŸäº›æƒ…å†µä¸‹çº¦æŸå¯èƒ½ä»æœªç”Ÿæ•ˆ
- é¿å… Haneke çš„æ–­è¨€å¤±è´¥

---

### æ ¸å¿ƒæ•™è®­

1. **ç†è§£ç¬¬ä¸‰æ–¹åº“çš„éšå«å‰ç½®æ¡ä»¶** - Haneke è¦æ±‚éé›¶å°ºå¯¸
2. **iOS å¸ƒå±€ç”Ÿå‘½å‘¨æœŸ** - `configure` å’Œå¸ƒå±€ç”Ÿæ•ˆä¹‹é—´æœ‰æ—¶é—´å·®
3. **å¼‚æ­¥ç¼–ç¨‹æŠ€å·§** - `DispatchQueue.main.async` å»¶è¿Ÿåˆ°ä¸‹ä¸€ä¸ª runloop
4. **é˜²å¾¡æ€§ç¼–ç¨‹** - åŒé‡ä¿éšœ + ä¸¥æ ¼æ£€æŸ¥ + èµ„æºæ¸…ç†

---


